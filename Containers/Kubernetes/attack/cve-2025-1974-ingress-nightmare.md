# ğŸš¨ CVE-2025-1974 â€“ IngressNightmare Vulnerability Overview

**CVE-2025-1974**, also known as **IngressNightmare**, is a critical vulnerability in the Kubernetes Ingress-NGINX Controller, first disclosed in March 2025. This unauthenticated remote code execution (RCE) vulnerability affects a core component used in thousands of Kubernetes clusters, allowing attackers to gain access to the ingress controller pod and pivot to full cluster compromise.

---

## ğŸ“Œ Background: What is the Ingress-NGINX Controller?

The Ingress-NGINX Controller is a Kubernetes-native ingress controller that translates Kubernetes `Ingress` resources into NGINX routing configurations. It serves as the gateway between external traffic and internal services in the cluster.

Ingress-NGINX is one of the most popular ingress implementations, used in both development and production environments.

---

## ğŸ”¥ Vulnerability Summary

CVE-2025-1974 stems from two interconnected issues:

- **Unprotected Admission Controller Endpoint:** The webhook used by Ingress-NGINX to validate Ingress configurations is exposed within the cluster without authentication.
- **Unsafe Handling of Annotations:** Attackers can inject malicious NGINX configuration through unsanitized annotations. During validation (`nginx -t`), this configuration is interpreted and executed.

Combined, these issues allow an attacker to:

1. Upload a malicious shared object (SO) file to the ingress controllerâ€™s file system by abusing NGINXâ€™s body buffering.
2. Inject a configuration directive (e.g., `ssl_engine`) referencing the uploaded SO file.
3. Achieve code execution when `nginx -t` is run during admission control.

---

## âš™ï¸ Affected Versions

- Ingress-NGINX versions below **1.11.5** or **1.12.1** are vulnerable.
- Fixed in versions **1.11.5+** and **1.12.1+**.

---

## ğŸ§ª Exploitation Flow

### 1. Identify Vulnerable Ingress Controllers

```bash
kubectl get pods --all-namespaces --selector app.kubernetes.io/name=ingress-nginx -o wide
```

Review the container image version and check if itâ€™s below the patched versions.

### 2. Send Malicious AdmissionReview Request

By sending a custom-crafted AdmissionReview API request, an attacker can inject malicious annotations such as:

```yaml
nginx.ingress.kubernetes.io/auth-url: "http://x#;ssl_engine /proc/self/fd/123;"
```

These annotations are processed during the webhook validation, leading to configuration injection.

### 3. Upload a Malicious Shared Library

NGINX will buffer large HTTP request bodies to disk (e.g., `/tmp/nginx/client-body/0000000001`). An attacker can abuse this to upload a payload (e.g., a `.so` file).

### 4. Trigger Code Execution

Once uploaded, the attacker references the SO file in the malicious annotation. During validation (`nginx -t`), the injected directive (`ssl_engine`) causes NGINX to load and execute the malicious library.

### 5. Harvest Service Account Token

With code execution inside the ingress controller pod, the attacker can access the service account token mounted at:

```bash
/var/run/secrets/kubernetes.io/serviceaccount/token
```

This token can be used to authenticate to the Kubernetes API server. Its permissions vary by deployment but often include elevated access.

Example post-exploitation enumeration:

```bash
kubectl auth can-i --list --token=$TOKEN
```

If the service account has cluster-admin or broad RBAC permissions, the attacker can list secrets, deploy pods, or escalate further by installing privileged workloads.

---

## ğŸ¯ Impact

| Threat                   | Description                                                   |
| ------------------------ | ------------------------------------------------------------- |
| ğŸ§¨ Remote Code Execution | Achieved inside ingress controller pods                       |
| ğŸ” Token Theft           | Stealing service account tokens with elevated privileges      |
| ğŸ›°ï¸ Lateral Movement     | Using stolen tokens to explore or compromise other namespaces |
| ğŸš Persistent Access     | Deploying backdoors via DaemonSets or privileged pods         |

---

## ğŸ›¡ï¸ Mitigation & Best Practices

- âœ… **Upgrade Ingress-NGINX** to version `1.11.5` or `1.12.1` and above
- ğŸ”’ Use **NetworkPolicies** to restrict access to admission controllers
- ğŸ” Apply **Pod Security Standards** to reduce container privileges
- ğŸ” Enforce **annotation sanitization** and restrict custom ingress annotations
- ğŸš¨ Monitor and audit for suspicious AdmissionReview requests

---

## ğŸ” Detection Techniques

**External Nuclei Template:** Scans externally accessible admission controllers for misconfiguration and injection capability.

**Internal Cluster Nuclei Template:** Checks Ingress controller image tags from within the cluster to identify vulnerable versions.

These detection templates are maintained by ProjectDiscovery and can be used in CI/CD pipelines or internal audits.

---

## ğŸ“š References

- [Wiz Research Blog â€“ CVE-2025-1974](https://www.wiz.io/blog/ingress-nginx-kubernetes-vulnerabilities)
- [IngressNightmare PoC â€“ hakaioffsec GitHub](https://github.com/hakaioffsec/IngressNightmare-PoC)
- [ProjectDiscovery Blog](https://projectdiscovery.io/blog/ingressnightmare-unauth-rce-in-ingress-nginx)
- [Nuclei Templates for Detection](https://github.com/projectdiscovery/nuclei-templates)

---

## âœï¸ Final Notes

IngressNightmare highlights a dangerous interaction between admission controls, unsafe NGINX behavior, and Kubernetes extensibility. It's a reminder that admission webhooks should be tightly scoped and isolated, and that container boundaries offer limited security when control-plane components are misconfigured.

Security engineers should treat ingress controllers as high-value assets and monitor them with the same scrutiny as API servers or kubelets.

